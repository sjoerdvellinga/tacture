version: 1

applications:
  # =========================
  # Landing app (apps/landing)
  # =========================
  - appRoot: apps/landing
    frontend:
      phases:
        preBuild:
          commands:
            # Ga naar repo root zodat workspaces correct installeren
            - cd ../..
            - npm ci --include=dev
        build:
          commands:
            # Build altijd met webpack om turbopack issues te vermijden
            - npm -w apps/landing run build -- --webpack
      artifacts:
        # RELATIEF AAN appRoot (apps/landing)
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          # root node_modules (RELATIEF AAN appRoot)
          - ../../node_modules/**/*
          # Next build cache (RELATIEF AAN appRoot)
          - .next/cache/**/*

  # =====================
  # Web app (apps/web)
  # =====================
  - appRoot: apps/web
    frontend:
      phases:
        preBuild:
          commands:
            - cd ../..
            - npm ci --include=dev
        build:
          commands:
            - npm -w apps/web run build -- --webpack
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - ../../node_modules/**/*
          - .next/cache/**/*